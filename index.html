<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cashav - Personal Finance Manager</title>
    <style>
        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            scroll-behavior: smooth;
        }

        html {
            scroll-padding-top: 2rem;
        }

        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #e0e0e0;
            background-color: #0a0a0a;
            background-image: radial-gradient(circle at 50% 50%, #1a1a1a 0%, #0a0a0a 100%);
        }

        /* Layout */
        body {
            display: grid;
            grid-template-columns: 250px 1fr;
            min-height: 100vh;
        }

        .sidebar {
            background-color: rgba(30, 30, 30, 0.7);
            backdrop-filter: blur(10px);
            color: #4eff8a;
            padding: 1.5rem;
            grid-column: 1;
            grid-row: 1;
            border-right: 1px solid rgba(51, 51, 51, 0.5);
            height: 100vh;
            position: fixed;
            width: 250px;
            display: flex;
            flex-direction: column;
            gap: 2rem;
            box-shadow: 5px 0 15px rgba(0, 0, 0, 0.2);
        }

        .logo {
            text-align: center;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid rgba(51, 51, 51, 0.5);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.2rem;
        }

        .logo-icon {
            font-size: 2.3rem;
            margin-bottom: 0.1rem;
            filter: drop-shadow(0 2px 8px #4eff8a88);
            animation: logo-bounce 1.8s infinite cubic-bezier(.68, -0.55, .27, 1.55);
        }

        @keyframes logo-bounce {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-7px);
            }
        }

        .cashav-logo {
            margin-bottom: 0.5rem;
            font-size: 2.5rem;
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-weight: 900;
            background: linear-gradient(90deg, #4eff8a 10%, #00bfff 60%, #a669ff 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 1.5px;
            text-shadow: 0 2px 16px #00bfff44, 0 1px 0 #23223a;
            filter: drop-shadow(0 0 8px #4eff8a55);
            transition: text-shadow 0.2s, filter 0.2s;
        }

        .cashav-logo:hover {
            text-shadow: 0 4px 32px #00bfff99, 0 2px 0 #23223a;
            filter: drop-shadow(0 0 16px #4eff8a99);
        }

        .logo p {
            color: #888;
            font-size: 0.9rem;
        }

        /* Plus icon removed as requested */

        .sidebar-nav ul {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .sidebar-nav a {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.85rem 1.25rem;
            color: #e0e0e0;
            text-decoration: none;
            border-radius: 12px;
            transition: all 0.2s;
            font-weight: 500;
            font-size: 0.95rem;
        }

        .sidebar-nav a:hover,
        .sidebar-nav a.active {
            background-color: rgba(78, 255, 138, 0.1);
            color: #4eff8a;
            box-shadow: 0 0 10px rgba(78, 255, 138, 0.1);
        }

        .sidebar-nav .icon {
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            background-color: rgba(78, 255, 138, 0.1);
            border-radius: 8px;
        }

        main {
            grid-column: 2;
            padding: 2rem;
            background-color: transparent;
        }

        .container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        footer {
            text-align: center;
            padding: 1.5rem;
            background-color: rgba(30, 30, 30, 0.5);
            backdrop-filter: blur(10px);
            color: #888;
            margin-top: 2rem;
            border-top: 1px solid rgba(51, 51, 51, 0.5);
            border-radius: 12px;
        }

        footer span {
            color: #4eff8a;
        }

        /* Dashboard */
        .dashboard {
            margin-bottom: 2.5rem;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin-bottom: 2.5rem;
        }

        .card {
            background-color: rgba(30, 30, 30, 0.7);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 1.75rem;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            text-align: center;
            border: 1px solid rgba(51, 51, 51, 0.5);
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, transparent, rgba(78, 255, 138, 0.5), transparent);
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.25);
        }

        .card h3 {
            margin-bottom: 0.75rem;
            font-size: 1rem;
            color: #aaa;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 500;
        }

        .card .amount {
            font-size: 2.25rem;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .total-balance {
            background-color: rgba(30, 30, 30, 0.7);
            position: relative;
        }

        .total-balance::before {
            background: linear-gradient(90deg, transparent, rgba(0, 191, 255, 0.5), transparent);
        }

        .total-balance .amount {
            color: #00bfff;
            text-shadow: 0 0 10px rgba(0, 191, 255, 0.3);
        }

        .total-credits {
            background-color: rgba(30, 30, 30, 0.7);
            position: relative;
        }

        .total-credits::before {
            background: linear-gradient(90deg, transparent, rgba(78, 255, 138, 0.5), transparent);
        }

        .total-credits .amount {
            color: #4eff8a;
            text-shadow: 0 0 10px rgba(78, 255, 138, 0.3);
        }

        .total-debits {
            background-color: rgba(30, 30, 30, 0.7);
            position: relative;
        }

        .total-debits::before {
            background: linear-gradient(90deg, transparent, rgba(255, 71, 87, 0.5), transparent);
        }

        .total-debits .amount {
            color: #ff4757;
            text-shadow: 0 0 10px rgba(255, 71, 87, 0.3);
        }

        /* Sections */
        section {
            background-color: rgba(30, 30, 30, 0.7);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 2.5rem;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            margin-bottom: 2.5rem;
            border: 1px solid rgba(51, 51, 51, 0.5);
        }

        section h2 {
            margin-bottom: 1.75rem;
            color: #4eff8a;
            border-bottom: 1px solid rgba(51, 51, 51, 0.5);
            padding-bottom: 0.75rem;
            font-size: 1.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        section h2::before {
            content: '';
            width: 4px;
            height: 24px;
            background: linear-gradient(to bottom, #00ff7f, #00bfff);
            border-radius: 2px;
        }

        /* Forms */
        .form-container {
            background-color: rgba(37, 37, 37, 0.7);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2.5rem;
            border: 1px solid rgba(51, 51, 51, 0.5);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }

        .form-container h3 {
            margin-bottom: 1.75rem;
            color: #00bfff;
            font-size: 1.4rem;
            letter-spacing: -0.5px;
            position: relative;
            padding-bottom: 0.75rem;
        }

        .form-container h3::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 60px;
            height: 3px;
            background: linear-gradient(90deg, #00bfff, transparent);
            border-radius: 3px;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.75rem;
            font-weight: 500;
            color: #ccc;
            font-size: 0.95rem;
        }

        input,
        select {
            width: 100%;
            padding: 1rem 1.2rem;
            border: 1px solid rgba(68, 68, 68, 0.5);
            border-radius: 12px;
            font-size: 1rem;
            background-color: rgba(51, 51, 51, 0.5);
            color: #e0e0e0;
            transition: all 0.2s;
            backdrop-filter: blur(5px);
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: #00bfff;
            box-shadow: 0 0 0 3px rgba(0, 191, 255, 0.2);
            background-color: rgba(51, 51, 51, 0.7);
        }

        .radio-group {
            display: flex;
            gap: 1.5rem;
            margin-top: 0.75rem;
        }

        .radio-option {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 0.5rem 0.75rem;
            border-radius: 8px;
            transition: all 0.2s;
        }

        .radio-option:hover {
            background-color: rgba(51, 51, 51, 0.5);
        }

        .radio-option input[type="radio"] {
            width: auto;
            margin-right: 0.75rem;
            cursor: pointer;
            accent-color: #4eff8a;
            height: 1.2rem;
            width: 1.2rem;
        }

        .radio-option label {
            margin-bottom: 0;
            cursor: pointer;
        }

        /* Amount Input Group */
        .amount-input-group {
            position: relative;
            display: flex;
            align-items: center;
        }

        .currency-symbol {
            position: absolute;
            left: 1.2rem;
            color: #aaa;
            font-weight: bold;
        }

        .amount-input-group input {
            padding-left: 2.2rem;
        }

        .form-actions {
            display: flex;
            gap: 1.25rem;
            margin-top: 2rem;
        }

        /* Buttons */
        .btn {
            background-color: rgba(78, 255, 138, 0.1);
            color: #4eff8a;
            border: 1px solid rgba(78, 255, 138, 0.3);
            padding: 0.85rem 1.5rem;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
            z-index: 1;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, rgba(78, 255, 138, 0.1), rgba(0, 191, 255, 0.1));
            z-index: -1;
            transition: opacity 0.3s ease;
            opacity: 0;
        }

        .btn:hover::before {
            opacity: 1;
        }

        .btn:hover {
            box-shadow: 0 0 15px rgba(78, 255, 138, 0.3);
            transform: translateY(-2px);
        }

        .btn-primary {
            background-color: rgba(78, 255, 138, 0.2);
        }

        .btn-secondary {
            background-color: rgba(51, 51, 51, 0.5);
            color: #ccc;
            border-color: rgba(102, 102, 102, 0.3);
        }

        .btn-secondary:hover {
            box-shadow: 0 0 15px rgba(102, 102, 102, 0.3);
        }

        /* Table */
        .table-container {
            overflow-x: auto;
            margin-top: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            background-color: rgba(37, 37, 37, 0.5);
            border: 1px solid rgba(51, 51, 51, 0.5);
        }

        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            color: #e0e0e0;
        }

        th {
            background-color: rgba(51, 51, 51, 0.7);
            padding: 1.25rem 1.5rem;
            text-align: left;
            font-weight: 600;
            color: #4eff8a;
            font-size: 0.95rem;
            letter-spacing: 0.5px;
            border-bottom: 1px solid rgba(78, 255, 138, 0.2);
        }

        th:first-child {
            border-top-left-radius: 12px;
        }

        th:last-child {
            border-top-right-radius: 12px;
        }

        td {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid rgba(51, 51, 51, 0.5);
            font-size: 0.95rem;
        }

        tr:last-child td {
            border-bottom: none;
        }

        tr:hover td {
            background-color: rgba(51, 51, 51, 0.3);
        }

        .credit {
            color: #4eff8a;
            font-weight: 600;
            position: relative;
        }

        .credit::before {
            content: '';
            display: inline-block;
            width: 8px;
            height: 8px;
            background-color: #4eff8a;
            border-radius: 50%;
            margin-right: 8px;
        }

        .debit {
            color: #ff4757;
            font-weight: 600;
            position: relative;
        }

        .debit::before {
            content: '';
            display: inline-block;
            width: 8px;
            height: 8px;
            background-color: #ff4757;
            border-radius: 50%;
            margin-right: 8px;
        }

        .action-btn {
            background-color: rgba(51, 51, 51, 0.7);
            color: #ccc;
            border: 1px solid rgba(102, 102, 102, 0.3);
            padding: 0.5rem 0.75rem;
            border-radius: 8px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .action-btn:hover {
            background-color: rgba(51, 51, 51, 0.9);
        }

        .delete-btn {
            color: #ff4757;
            border-color: rgba(255, 71, 87, 0.3);
        }

        .delete-btn:hover {
            background-color: rgba(255, 71, 87, 0.1);
        }

        .hidden {
            display: none;
        }

        .no-data-message {
            text-align: center;
            padding: 2rem;
            color: #888;
            font-style: italic;
        }

        /* Income Section Specific Styles */
        .income-section {
            display: none;
        }

        /* NYC Chilling Look for Total Income */
        .summary-card {
            background: linear-gradient(135deg, #1c1c1c, #2a2a2a);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3), inset 0 1px 1px rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.05);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .summary-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="none" stroke="rgba(255,255,255,0.03)" stroke-width="1"/></svg>');
            opacity: 0.3;
            pointer-events: none;
        }

        .summary-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4), inset 0 1px 1px rgba(255, 255, 255, 0.1);
        }

        .summary-card h3 {
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: #aaa;
            margin-bottom: 1rem;
            font-weight: 600;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .summary-card .amount {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(90deg, #4eff8a, #00bfff, #a669ff);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 10px rgba(78, 255, 138, 0.3);
            letter-spacing: -1px;
            position: relative;
            display: inline-block;
        }

        /* Responsive */
        @media (max-width: 768px) {
            body {
                display: block;
            }

            .sidebar {
                position: static;
                width: 100%;
                height: auto;
                margin-bottom: 2rem;
            }

            main {
                grid-column: 1;
                padding: 1rem;
            }

            .summary-cards {
                grid-template-columns: 1fr;
            }

            .form-actions {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }

        .highlight-desc {
            background: linear-gradient(90deg, #232323 60%, #4eff8a22 100%);
            color: #fff;
            font-weight: bold;
        }

        .transaction-history td.highlight-desc {
            background: #232323;
            color: #4eff8a;
            font-weight: bold;
        }

        /* Toggle Switch */
        .switch {
            position: relative;
            display: inline-block;
            width: 48px;
            height: 24px;
        }

        .switch input {
            display: none;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #888;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: #fff;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked+.slider {
            background-color: #4eff8a;
        }

        input:checked+.slider:before {
            transform: translateX(24px);
        }

        .autosave-toggle-container {
            position: fixed;
            left: 32px;
            bottom: 32px;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 18px;
            background: rgba(30, 30, 30, 0.95);
            border-radius: 16px;
            box-shadow: 0 4px 16px rgba(44, 44, 84, 0.18);
            padding: 14px 24px 14px 20px;
            border: 1px solid rgba(78, 255, 138, 0.18);
        }

        .autosave-toggle-label {
            color: #4eff8a;
            font-weight: 600;
            font-size: 1.08rem;
            letter-spacing: 0.5px;
            margin-right: 8px;
            text-shadow: 0 1px 8px #23223a44;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 54px;
            height: 28px;
        }

        .switch input {
            display: none;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #888;
            transition: .4s;
            border-radius: 28px;
            box-shadow: 0 2px 8px #0002;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 3px;
            bottom: 3px;
            background-color: #fff;
            transition: .4s;
            border-radius: 50%;
            box-shadow: 0 1px 4px #0002;
        }

        input:checked+.slider {
            background: linear-gradient(90deg, #4eff8a 60%, #00bfff 100%);
            box-shadow: 0 2px 12px #4eff8a33;
        }

        input:checked+.slider:before {
            transform: translateX(26px);
            background: #4eff8a;
        }

        .slider.round {
            border-radius: 28px;
        }

        .autosave-toggle-btn {
            position: fixed;
            left: 32px;
            bottom: 32px;
            z-index: 1100;
            background: rgba(30, 30, 30, 0.95);
            border: 1.5px solid #4eff8a44;
            border-radius: 50%;
            width: 54px;
            height: 54px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 16px rgba(44, 44, 84, 0.18);
            cursor: pointer;
            transition: background 0.2s, box-shadow 0.2s;
        }

        .autosave-toggle-btn:hover {
            background: #23223a;
            box-shadow: 0 6px 24px #4eff8a33;
        }

        .autosave-toggle-btn svg {
            display: block;
        }

        .autosave-toggle-container {
            position: fixed;
            left: 100px;
            bottom: 32px;
            z-index: 1099;
            display: flex;
            align-items: center;
            gap: 18px;
            background: rgba(30, 30, 30, 0.95);
            border-radius: 16px;
            box-shadow: 0 4px 16px rgba(44, 44, 84, 0.18);
            padding: 14px 24px 14px 20px;
            border: 1px solid rgba(78, 255, 138, 0.18);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.25s, left 0.25s;
        }

        .autosave-toggle-container.visible {
            opacity: 1;
            pointer-events: auto;
            left: 100px;
        }
    </style>
</head>

<body>
    <header class="sidebar">
        <div class="logo">
            <span class="logo-icon">💸</span>
            <h1 class="cashav-logo">Cashav</h1>
            <p>Personal Finance Manager</p>
        </div>
        <nav class="sidebar-nav">
            <ul>
                <li><a href="#" class="active" data-section="dashboard"><span class="icon">📊</span>Dashboard</a></li>
                <li><a href="#" data-section="accounts"><span class="icon">🏦</span>Accounts</a></li>
                <li><a href="#" data-section="transactions"><span class="icon">💸</span>Transactions</a></li>
                <li><a href="#" data-section="income"><span class="icon">💰</span>Income Tracker</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <!-- Dashboard Section -->
        <section id="dashboard" class="dashboard">
            <h2>Dashboard Overview</h2>
            <div class="summary-cards">
                <div class="card total-balance">
                    <h3>Total Balance</h3>
                    <p class="amount" id="total-balance">$0.00</p>
                </div>
                <div class="card total-credits">
                    <h3>Total Credits</h3>
                    <p class="amount" id="total-credits">$0.00</p>
                </div>
                <div class="card total-debits">
                    <h3>Total Debits</h3>
                    <p class="amount" id="total-debits">$0.00</p>
                </div>
            </div>
            <!-- Account Balance Checker -->
            <div class="form-container" style="max-width:400px;margin:2rem 0;">
                <h3 style="color:#00bfff;">Check Account Balance</h3>
                <div class="form-group" style="display:flex;gap:0.5rem;align-items:center;">
                    <label for="dashboard-account-select" style="flex:1;">Select Account</label>
                    <select id="dashboard-account-select"
                        style="flex:2;width:100%;padding:0.75rem 1rem;border-radius:8px;font-size:1rem;"></select>
                    <button id="dashboard-account-ok-btn" class="btn btn-primary"
                        style="padding:0.75rem 1.5rem;">Okay</button>
                </div>
                <div id="dashboard-account-balance-card" class="card"
                    style="margin-top:1rem;display:none;background:rgba(30,30,30,0.7);">
                    <h3 id="dashboard-account-name" style="color:#4eff8a;margin-bottom:0.5rem;"></h3>
                    <p style="color:#aaa;font-size:0.95rem;margin-bottom:0.5rem;">Current Balance</p>
                    <p class="amount" id="dashboard-account-balance">$0.00</p>
                </div>
            </div>
        </section>

        <!-- Accounts Section -->
        <section id="accounts" class="accounts">
            <h2>Bank Accounts</h2>
            <button id="add-account-btn" class="btn">Add New Account</button>

            <div id="account-form-container" class="form-container hidden">
                <form id="account-form">
                    <h3>Add New Account</h3>

                    <div class="form-group">
                        <label for="bank-name">Bank Name</label>
                        <input type="text" id="bank-name" name="bank-name" placeholder="e.g. Chase, Bank of America"
                            required>
                    </div>

                    <div class="form-group">
                        <label for="account-number">Account Number</label>
                        <input type="text" id="account-number" name="account-number"
                            placeholder="Last 4 digits of your account" required>
                    </div>

                    <div class="form-group">
                        <label for="opening-balance">Opening Balance</label>
                        <div class="amount-input-group">
                            <span class="currency-symbol">$</span>
                            <input type="number" id="opening-balance" name="opening-balance" step="0.01" min="0"
                                required>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Save Account</button>
                        <button type="button" id="cancel-account-btn" class="btn btn-secondary">Cancel</button>
                    </div>
                </form>
            </div>

            <div class="table-container">
                <table id="accounts-table">
                    <thead>
                        <tr>
                            <th>Bank Name</th>
                            <th>Account Number</th>
                            <th>Current Balance</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="accounts-list"></tbody>
                </table>
            </div>
            <p id="no-accounts-message" class="no-data-message hidden">No accounts found. Add your first account!</p>
        </section>

        <!-- Transactions Section -->
        <section id="transactions" class="transactions">
            <h2>Transactions</h2>
            <button id="add-transaction-btn" class="btn">Add New Transaction</button>
            <button id="toggle-filter-btn" class="btn btn-secondary">Show Filters</button>
            <button id="download-pdf-btn" class="btn btn-primary" style="float:right;">Download All as PDF</button>

            <div id="transactions-filter" class="form-container hidden">
                <h3>Filter Transactions</h3>
                <div class="form-group">
                    <label for="filter-account">Account</label>
                    <select id="filter-account">
                        <option value="all">All Accounts</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="filter-type">Transaction Type</label>
                    <select id="filter-type">
                        <option value="all">All Types</option>
                        <option value="Credit">Credit</option>
                        <option value="Debit">Debit</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="filter-date">Date</label>
                    <input type="date" id="filter-date">
                </div>

                <div class="form-actions">
                    <button id="apply-filter-btn" class="btn btn-primary">Apply Filters</button>
                    <button id="reset-filter-btn" class="btn btn-secondary">Reset Filters</button>
                </div>
            </div>

            <div id="transaction-form-container" class="form-container hidden">
                <form id="transaction-form">
                    <h3>Add New Transaction</h3>

                    <div class="form-group">
                        <label for="transaction-account">Account</label>
                        <select id="transaction-account" required>
                            <option value="">Select Account</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="transaction-date">Date</label>
                        <input type="date" id="transaction-date" name="transaction-date" required>
                        <label style="margin-left:1rem;">Time</label>
                        <input type="number" id="transaction-hour" min="1" max="12" required
                            style="width:50px;display:inline-block;" readonly disabled> :
                        <input type="number" id="transaction-minute" min="0" max="59" required
                            style="width:50px;display:inline-block;" readonly disabled> :
                        <input type="number" id="transaction-second" min="0" max="59" required
                            style="width:50px;display:inline-block;" readonly disabled>
                        <select id="transaction-ampm" required style="width:70px;display:inline-block;" disabled>
                            <option value="AM">AM</option>
                            <option value="PM">PM</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Transaction Type</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="type-credit" name="transaction-type" value="Credit" checked>
                                <label for="type-credit">Credit</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="type-debit" name="transaction-type" value="Debit">
                                <label for="type-debit">Debit</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="transaction-amount">Amount</label>
                        <div class="amount-input-group">
                            <span class="currency-symbol">$</span>
                            <input type="number" id="transaction-amount" name="transaction-amount" step="0.01" min="0"
                                required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="transaction-description">Description</label>
                        <input type="text" id="transaction-description" name="transaction-description"
                            placeholder="What's this transaction for?" required>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Save Transaction</button>
                        <button type="button" id="cancel-transaction-btn" class="btn btn-secondary">Cancel</button>
                    </div>
                </form>
            </div>

            <div class="table-container">
                <table id="transactions-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Time</th>
                            <th>Account</th>
                            <th>Type</th>
                            <th>Amount</th>
                            <th>Description</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="transactions-list"></tbody>
                </table>
            </div>
            <p id="no-transactions-message" class="no-data-message hidden">No transactions found. Add your first
                transaction!</p>
        </section>

        <!-- Income Section -->
        <section id="income" class="income-section">
            <div class="summary-card">
                <h3>Total Daily Income</h3>
                <p class="amount" id="total-income">$0.00</p>
            </div>

            <h2>Income Entries</h2>
            <button id="add-income-btn" class="btn">Add New Income</button>

            <div id="income-form-container" class="form-container hidden">
                <form id="income-form">
                    <h3>Add New Income</h3>

                    <div class="form-group">
                        <label for="income-date">Date</label>
                        <input type="date" id="income-date" name="income-date" required>
                    </div>

                    <div class="form-group">
                        <label for="income-source">Source</label>
                        <input type="text" id="income-source" name="income-source"
                            placeholder="e.g. Freelance, Salary, etc." required>
                    </div>

                    <div class="form-group">
                        <label for="income-amount">Amount</label>
                        <div class="amount-input-group">
                            <span class="currency-symbol">$</span>
                            <input type="number" id="income-amount" name="income-amount" step="0.01" min="0" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="income-description">Description (Optional)</label>
                        <input type="text" id="income-description" name="income-description"
                            placeholder="Additional details about this income">
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Save Income</button>
                        <button type="button" id="cancel-income-btn" class="btn btn-secondary">Cancel</button>
                    </div>
                </form>
            </div>

            <div class="table-container">
                <table id="income-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Source</th>
                            <th>Amount</th>
                            <th>Description</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="income-list"></tbody>
                </table>
            </div>
            <p id="no-income-message" class="no-data-message hidden">No income entries found. Add your first income
                entry!</p>
        </section>

        <footer>
            <p>Cashav - Personal Finance Manager | <span>Made by Keshav</span></p>
        </footer>
        <button id="autosave-toggle-btn" class="autosave-toggle-btn" title="Show Auto-Save Settings">
            <svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="#4eff8a" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="3" />
                <path
                    d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09A1.65 1.65 0 0 0 8 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.6 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 1 1 0-4h.09A1.65 1.65 0 0 0 4.6 8a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 8 4.6a1.65 1.65 0 0 0 1-1.51V3a2 2 0 1 1 4 0v.09c0 .66.39 1.26 1 1.51a1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 8c.13.31.2.65.2 1v.09c0 .66-.39 1.26-1 1.51a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 16 4.6a1.65 1.65 0 0 0 1.51 1H21a2 2 0 1 1 0 4h-.09c-.66 0-1.26.39-1.51 1a1.65 1.65 0 0 0-.33 1.82z" />
            </svg>
        </button>
        <div class="autosave-toggle-container" id="autosave-toggle-container" style="display:none;">
            <div class="autosave-toggle-label">Auto-Save Monthly PDF</div>
            <label class="switch">
                <input type="checkbox" id="autoSaveMonthlyPdfToggle">
                <span class="slider round"></span>
            </label>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.9.0/dist/mermaid.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.2/dist/jspdf.plugin.autotable.min.js"></script>
    <script>
        // DOM Elements - Dashboard
        const totalBalanceElement = document.getElementById('total-balance');
        const totalCreditsElement = document.getElementById('total-credits');
        const totalDebitsElement = document.getElementById('total-debits');

        // DOM Elements - Accounts
        const accountForm = document.getElementById('account-form');
        const accountFormContainer = document.getElementById('account-form-container');
        const addAccountBtn = document.getElementById('add-account-btn');
        const cancelAccountBtn = document.getElementById('cancel-account-btn');
        const accountsTable = document.getElementById('accounts-table');
        const accountsList = document.getElementById('accounts-list');
        const noAccountsMessage = document.getElementById('no-accounts-message');

        // DOM Elements - Transactions
        const transactionForm = document.getElementById('transaction-form');
        const transactionFormContainer = document.getElementById('transaction-form-container');
        const addTransactionBtn = document.getElementById('add-transaction-btn');
        const cancelTransactionBtn = document.getElementById('cancel-transaction-btn');
        const transactionsTable = document.getElementById('transactions-table');
        const transactionsList = document.getElementById('transactions-list');
        const noTransactionsMessage = document.getElementById('no-transactions-message');
        const transactionAccountSelect = document.getElementById('transaction-account');

        // DOM Elements - Filters
        const transactionsFilter = document.getElementById('transactions-filter');
        const toggleFilterBtn = document.getElementById('toggle-filter-btn');
        const applyFilterBtn = document.getElementById('apply-filter-btn');
        const resetFilterBtn = document.getElementById('reset-filter-btn');
        const filterAccountSelect = document.getElementById('filter-account');
        const filterType = document.getElementById('filter-type');
        const filterDate = document.getElementById('filter-date');

        // DOM Elements - Income
        const incomeForm = document.getElementById('income-form');
        const incomeFormContainer = document.getElementById('income-form-container');
        const addIncomeBtn = document.getElementById('add-income-btn');
        const cancelIncomeBtn = document.getElementById('cancel-income-btn');
        const incomeTable = document.getElementById('income-table');
        const incomeList = document.getElementById('income-list');
        const noIncomeMessage = document.getElementById('no-income-message');
        const totalIncomeElement = document.getElementById('total-income');

        // DOM Elements - PDF
        const downloadPdfBtn = document.getElementById('download-pdf-btn');

        // Dashboard Account Balance Checker
        const dashboardAccountSelect = document.getElementById('dashboard-account-select');
        const dashboardAccountBalanceCard = document.getElementById('dashboard-account-balance-card');
        const dashboardAccountName = document.getElementById('dashboard-account-name');
        const dashboardAccountBalance = document.getElementById('dashboard-account-balance');
        const dashboardAccountOkBtn = document.getElementById('dashboard-account-ok-btn');

        // Navigation Elements
        const navLinks = document.querySelectorAll('.sidebar-nav a');
        const sections = document.querySelectorAll('main > section');

        // Data Storage
        let accounts = [];
        let transactions = [];
        let incomeEntries = [];

        // Initialize App
        async function initApp() {
            try {
                // Set current date for forms
                setCurrentDate();

                // Initialize database and load data
                await initDatabase();
                await loadDataFromLocalStorage();

                // Render data
                renderAccounts();
                renderTransactions();
                renderIncomeEntries();
                updateAccountDropdowns();
                updateDashboard();
                updateTotalIncome();

                // Show dashboard by default
                showSection('dashboard');

                console.log('App initialized successfully with IndexedDB');
            } catch (error) {
                console.error('Error initializing app:', error);
                alert('There was an error loading your data. Some features may not work correctly.');
            }
        }

        // Navigation: Remove transaction-history and monthly history
        function showSection(sectionId) {
            // Hide all sections
            sections.forEach(section => {
                section.style.display = 'none';
            });

            // Show the selected section
            document.getElementById(sectionId).style.display = 'block';

            // Update active nav link
            navLinks.forEach(link => {
                if (link.getAttribute('data-section') === sectionId) {
                    link.classList.add('active');
                } else {
                    link.classList.remove('active');
                }
            });
        }

        // Helper to pad numbers
        function pad2(n) { return n.toString().padStart(2, '0'); }

        // Helper to format time as 12-hour with AM/PM
        function formatTime12h(timeStr) {
            if (!timeStr) return '-';
            const [h, m, s] = timeStr.split(':');
            let hour = parseInt(h, 10);
            const minute = m;
            const second = s || '00';
            const ampm = hour >= 12 ? 'PM' : 'AM';
            hour = hour % 12;
            if (hour === 0) hour = 12;
            return `${hour}:${minute}:${second} ${ampm}`;
        }
        // Helper to convert 12h to 24h string
        function to24HourString(hour, minute, ampm, second) {
            hour = parseInt(hour, 10);
            minute = pad2(minute);
            second = pad2(second);
            if (ampm === 'PM' && hour !== 12) hour += 12;
            if (ampm === 'AM' && hour === 12) hour = 0;
            return pad2(hour) + ':' + minute + ':' + second;
        }
        // Helper to split 24h string to 12h parts
        function from24HourString(timeStr) {
            if (!timeStr) return { hour: '', minute: '', second: '', ampm: 'AM' };
            const [h, m, s] = timeStr.split(':');
            let hour = parseInt(h, 10);
            let ampm = 'AM';
            if (hour >= 12) ampm = 'PM';
            let hour12 = hour % 12;
            if (hour12 === 0) hour12 = 12;
            return { hour: hour12, minute: m, second: s || '00', ampm: ampm };
        }

        // Set Current Date and Time
        function setCurrentDate() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            const formattedDate = `${year}-${month}-${day}`;
            // Set date for transaction form
            if (document.getElementById('transaction-date')) {
                document.getElementById('transaction-date').value = formattedDate;
            }
            // Set date for income form
            if (document.getElementById('income-date')) {
                document.getElementById('income-date').value = formattedDate;
            }
            // Set time for transaction form (12-hour format fields)
            if (
                document.getElementById('transaction-hour') &&
                document.getElementById('transaction-minute') &&
                document.getElementById('transaction-second') &&
                document.getElementById('transaction-ampm')
            ) {
                let hours = today.getHours();
                let minutes = today.getMinutes();
                let seconds = today.getSeconds();
                let ampm = 'AM';
                if (hours >= 12) ampm = 'PM';
                let hour12 = hours % 12;
                if (hour12 === 0) hour12 = 12;
                document.getElementById('transaction-hour').value = hour12;
                document.getElementById('transaction-minute').value = pad2(minutes);
                document.getElementById('transaction-second').value = pad2(seconds);
                document.getElementById('transaction-ampm').value = ampm;
            }
        }

        // IndexedDB Database Functions
        let db;
        const DB_NAME = 'cashavDB';
        const DB_VERSION = 1;
        const STORES = {
            ACCOUNTS: 'accounts',
            TRANSACTIONS: 'transactions',
            INCOME: 'incomeEntries'
        };

        // Initialize the database
        function initDatabase() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, DB_VERSION);

                request.onerror = event => {
                    console.error('IndexedDB error:', event.target.error);
                    reject('Could not open database');
                };

                request.onsuccess = event => {
                    db = event.target.result;
                    console.log('Database opened successfully');
                    resolve(db);
                };

                request.onupgradeneeded = event => {
                    const db = event.target.result;

                    // Create object stores (tables) with auto-incrementing keys
                    if (!db.objectStoreNames.contains(STORES.ACCOUNTS)) {
                        const accountStore = db.createObjectStore(STORES.ACCOUNTS, { keyPath: 'id' });
                        accountStore.createIndex('name', 'name', { unique: false });
                    }

                    if (!db.objectStoreNames.contains(STORES.TRANSACTIONS)) {
                        const transactionStore = db.createObjectStore(STORES.TRANSACTIONS, { keyPath: 'id' });
                        transactionStore.createIndex('accountId', 'accountId', { unique: false });
                        transactionStore.createIndex('date', 'date', { unique: false });
                        transactionStore.createIndex('type', 'type', { unique: false });
                    }

                    if (!db.objectStoreNames.contains(STORES.INCOME)) {
                        const incomeStore = db.createObjectStore(STORES.INCOME, { keyPath: 'id' });
                        incomeStore.createIndex('date', 'date', { unique: false });
                        incomeStore.createIndex('source', 'source', { unique: false });
                    }
                };
            });
        }

        // Load data from IndexedDB
        async function loadDataFromLocalStorage() {
            try {
                await initDatabase();
                accounts = await getAllData(STORES.ACCOUNTS) || [];
                transactions = await getAllData(STORES.TRANSACTIONS) || [];
                incomeEntries = await getAllData(STORES.INCOME) || [];
            } catch (error) {
                console.error('Error loading data:', error);
                // Fallback to localStorage if IndexedDB fails
                const storedAccounts = localStorage.getItem('accounts');
                const storedTransactions = localStorage.getItem('transactions');
                const storedIncomeEntries = localStorage.getItem('incomeEntries');

                if (storedAccounts) accounts = JSON.parse(storedAccounts);
                if (storedTransactions) transactions = JSON.parse(storedTransactions);
                if (storedIncomeEntries) incomeEntries = JSON.parse(storedIncomeEntries);

                // Migrate data to IndexedDB
                if (db) {
                    if (accounts.length > 0) saveAllData(STORES.ACCOUNTS, accounts);
                    if (transactions.length > 0) saveAllData(STORES.TRANSACTIONS, transactions);
                    if (incomeEntries.length > 0) saveAllData(STORES.INCOME, incomeEntries);
                }
            }
        }

        // Save data to IndexedDB
        async function saveDataToLocalStorage() {
            try {
                if (!db) await initDatabase();

                await clearAllData(STORES.ACCOUNTS);
                await clearAllData(STORES.TRANSACTIONS);
                await clearAllData(STORES.INCOME);

                await saveAllData(STORES.ACCOUNTS, accounts);
                await saveAllData(STORES.TRANSACTIONS, transactions);
                await saveAllData(STORES.INCOME, incomeEntries);

                // Backup to localStorage as fallback
                localStorage.setItem('accounts', JSON.stringify(accounts));
                localStorage.setItem('transactions', JSON.stringify(transactions));
                localStorage.setItem('incomeEntries', JSON.stringify(incomeEntries));
            } catch (error) {
                console.error('Error saving data to IndexedDB:', error);
                // Fallback to localStorage
                localStorage.setItem('accounts', JSON.stringify(accounts));
                localStorage.setItem('transactions', JSON.stringify(transactions));
                localStorage.setItem('incomeEntries', JSON.stringify(incomeEntries));
            }
        }

        // Helper function to get all data from a store
        function getAllData(storeName) {
            return new Promise((resolve, reject) => {
                if (!db) {
                    reject('Database not initialized');
                    return;
                }

                const transaction = db.transaction(storeName, 'readonly');
                const store = transaction.objectStore(storeName);
                const request = store.getAll();

                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        }

        // Helper function to save all data to a store
        function saveAllData(storeName, data) {
            return new Promise((resolve, reject) => {
                if (!db) {
                    reject('Database not initialized');
                    return;
                }

                const transaction = db.transaction(storeName, 'readwrite');
                const store = transaction.objectStore(storeName);

                // Add each item to the store
                let completed = 0;
                data.forEach(item => {
                    const request = store.put(item);
                    request.onsuccess = () => {
                        completed++;
                        if (completed === data.length) resolve();
                    };
                    request.onerror = () => reject(request.error);
                });

                // If data is empty, resolve immediately
                if (data.length === 0) resolve();
            });
        }

        // Helper function to clear all data from a store
        function clearAllData(storeName) {
            return new Promise((resolve, reject) => {
                if (!db) {
                    reject('Database not initialized');
                    return;
                }

                const transaction = db.transaction(storeName, 'readwrite');
                const store = transaction.objectStore(storeName);
                const request = store.clear();

                request.onsuccess = () => resolve();
                request.onerror = () => reject(request.error);
            });
        }

        // Generate Unique ID
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        // Format Currency
        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 2
            }).format(amount);
        }

        // Format Date
        function formatDate(dateString) {
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return new Date(dateString).toLocaleDateString('en-US', options);
        }

        // Account Management
        function addAccount(event) {
            event.preventDefault();

            const bankName = document.getElementById('bank-name').value;
            const accountNumber = document.getElementById('account-number').value;
            const openingBalance = parseFloat(document.getElementById('opening-balance').value);

            // Validate account number uniqueness
            if (accounts.some(account => account.accountNumber === accountNumber)) {
                alert('An account with this account number already exists!');
                return;
            }

            const newAccount = {
                id: generateId(),
                bankName,
                accountNumber,
                openingBalance,
                currentBalance: openingBalance
            };

            accounts.push(newAccount);
            saveDataToLocalStorage();
            renderAccounts();
            updateAccountDropdowns();
            updateDashboard();
            accountForm.reset();
            toggleAccountForm();
        }

        function deleteAccount(accountId) {
            // Check if there are transactions for this account
            if (transactions.some(transaction => transaction.accountId === accountId)) {
                const confirmDelete = confirm('This account has transactions. Deleting it will also delete all associated transactions. Continue?');
                if (!confirmDelete) return;

                // Remove associated transactions
                transactions = transactions.filter(transaction => transaction.accountId !== accountId);
            } else {
                const confirmDelete = confirm('Are you sure you want to delete this account?');
                if (!confirmDelete) return;
            }

            // Remove the account
            accounts = accounts.filter(account => account.id !== accountId);
            saveDataToLocalStorage();
            renderAccounts();
            renderTransactions();
            updateAccountDropdowns();
            updateDashboard();
        }

        function renderAccounts() {
            if (accounts.length === 0) {
                accountsTable.classList.add('hidden');
                noAccountsMessage.classList.remove('hidden');
                return;
            }

            accountsTable.classList.remove('hidden');
            noAccountsMessage.classList.add('hidden');

            accountsList.innerHTML = '';

            accounts.forEach(account => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${account.bankName}</td>
                    <td>${account.accountNumber}</td>
                    <td>${formatCurrency(account.currentBalance)}</td>
                    <td>
                        <button class="action-btn delete-btn" data-id="${account.id}">Delete</button>
                    </td>
                `;
                accountsList.appendChild(row);
            });

            // Add event listeners to delete buttons
            document.querySelectorAll('#accounts-list .delete-btn').forEach(button => {
                button.addEventListener('click', () => {
                    deleteAccount(button.getAttribute('data-id'));
                });
            });
            updateDashboardAccountSelect();
        }

        function updateAccountDropdowns() {
            // Clear existing options
            transactionAccountSelect.innerHTML = '<option value="">Select Account</option>';
            filterAccountSelect.innerHTML = '<option value="all">All Accounts</option>';

            // Add account options
            accounts.forEach(account => {
                const transactionOption = document.createElement('option');
                transactionOption.value = account.id;
                transactionOption.textContent = `${account.bankName} - ${account.accountNumber}`;
                transactionAccountSelect.appendChild(transactionOption);

                const filterOption = document.createElement('option');
                filterOption.value = account.id;
                filterOption.textContent = `${account.bankName} - ${account.accountNumber}`;
                filterAccountSelect.appendChild(filterOption);
            });
        }

        // Transaction Management
        function addTransaction(event) {
            event.preventDefault();

            const accountId = document.getElementById('transaction-account').value;
            const date = document.getElementById('transaction-date').value;
            const hour = document.getElementById('transaction-hour').value;
            const minute = document.getElementById('transaction-minute').value;
            const second = document.getElementById('transaction-second').value;
            const ampm = document.getElementById('transaction-ampm').value;
            const time = to24HourString(hour, minute, ampm, second);
            const type = document.querySelector('input[name="transaction-type"]:checked').value;
            const amount = parseFloat(document.getElementById('transaction-amount').value);
            const description = document.getElementById('transaction-description').value;

            // Find the account
            const accountIndex = accounts.findIndex(account => account.id === accountId);
            if (accountIndex === -1) {
                alert('Please select a valid account.');
                return;
            }

            // Validate sufficient balance for debit transactions
            if (type === 'Debit' && amount > accounts[accountIndex].currentBalance) {
                alert('Insufficient balance for this transaction.');
                return;
            }

            const newTransaction = {
                id: generateId(),
                accountId,
                accountName: `${accounts[accountIndex].bankName} - ${accounts[accountIndex].accountNumber}`,
                date,
                time,
                type,
                amount,
                description
            };

            // Update account balance
            if (type === 'Credit') {
                accounts[accountIndex].currentBalance += amount;
            } else {
                accounts[accountIndex].currentBalance -= amount;
            }

            transactions.push(newTransaction);
            saveDataToLocalStorage();
            renderTransactions();
            renderAccounts(); // Update account balances display
            updateDashboard();
            transactionForm.reset();
            setCurrentDate();
            // Only close the form if it's currently visible
            if (!transactionFormContainer.classList.contains('hidden')) {
                toggleTransactionForm();
            }
        }

        function deleteTransaction(transactionId) {
            const confirmDelete = confirm('Are you sure you want to delete this transaction?');
            if (!confirmDelete) return;

            // Find the transaction
            const transaction = transactions.find(t => t.id === transactionId);
            if (!transaction) return;

            // Find the account
            const accountIndex = accounts.findIndex(account => account.id === transaction.accountId);
            if (accountIndex === -1) return;

            // Revert the account balance
            if (transaction.type === 'Credit') {
                accounts[accountIndex].currentBalance -= transaction.amount;
            } else {
                accounts[accountIndex].currentBalance += transaction.amount;
            }

            // Remove the transaction
            transactions = transactions.filter(t => t.id !== transactionId);
            saveDataToLocalStorage();
            renderTransactions();
            renderAccounts(); // Update account balances display
            updateDashboard();
            renderTransactionHistory();
        }

        function renderTransactions(filteredTransactions = null) {
            const transactionsToRender = filteredTransactions || transactions;

            if (transactionsToRender.length === 0) {
                transactionsTable.classList.add('hidden');
                noTransactionsMessage.classList.remove('hidden');
                return;
            }

            transactionsTable.classList.remove('hidden');
            noTransactionsMessage.classList.add('hidden');

            transactionsList.innerHTML = '';

            // Sort transactions by date (newest first)
            const sortedTransactions = [...transactionsToRender].sort((a, b) => new Date(b.date) - new Date(a.date));

            sortedTransactions.forEach(transaction => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formatDate(transaction.date)}</td>
                    <td>${formatTime12h(transaction.time)}</td>
                    <td>${transaction.accountName}</td>
                    <td class="${transaction.type === 'Credit' ? 'credit' : 'debit'}">${transaction.type}</td>
                    <td>${formatCurrency(transaction.amount)}</td>
                    <td>${transaction.description}</td>
                    <td>
                        <button class="action-btn delete-btn" data-id="${transaction.id}">Delete</button>
                    </td>
                `;
                transactionsList.appendChild(row);
            });

            // Add event listeners to delete buttons
            document.querySelectorAll('#transactions-list .delete-btn').forEach(button => {
                button.addEventListener('click', () => {
                    deleteTransaction(button.getAttribute('data-id'));
                });
            });
        }

        // Filter Transactions
        function filterTransactions() {
            const accountId = filterAccountSelect.value;
            const type = filterType.value;
            const date = filterDate.value;

            let filtered = [...transactions];

            // Filter by account
            if (accountId !== 'all') {
                filtered = filtered.filter(transaction => transaction.accountId === accountId);
            }

            // Filter by type
            if (type !== 'all') {
                filtered = filtered.filter(transaction => transaction.type === type);
            }

            // Filter by exact date
            if (date) {
                filtered = filtered.filter(transaction => transaction.date === date);
            }

            renderTransactions(filtered);
        }

        function resetFilters() {
            filterAccountSelect.value = 'all';
            filterType.value = 'all';
            filterDate.value = '';
            renderTransactions();
        }

        // Income Management
        function addIncome(event) {
            event.preventDefault();

            const date = document.getElementById('income-date').value;
            const source = document.getElementById('income-source').value;
            const amount = parseFloat(document.getElementById('income-amount').value);
            const description = document.getElementById('income-description').value || 'N/A';

            const newIncome = {
                id: generateId(),
                date,
                source,
                amount,
                description
            };

            incomeEntries.push(newIncome);
            saveDataToLocalStorage();
            renderIncomeEntries();
            updateTotalIncome();
            incomeForm.reset();
            setCurrentDate();
            toggleIncomeForm();
        }

        function deleteIncome(incomeId) {
            const confirmDelete = confirm('Are you sure you want to delete this income entry?');
            if (!confirmDelete) return;

            // Remove the income entry
            incomeEntries = incomeEntries.filter(entry => entry.id !== incomeId);
            saveDataToLocalStorage();
            renderIncomeEntries();
            updateTotalIncome();
        }

        function renderIncomeEntries() {
            if (incomeEntries.length === 0) {
                incomeTable.classList.add('hidden');
                noIncomeMessage.classList.remove('hidden');
                return;
            }

            incomeTable.classList.remove('hidden');
            noIncomeMessage.classList.add('hidden');

            incomeList.innerHTML = '';

            // Sort income entries by date (newest first)
            const sortedEntries = [...incomeEntries].sort((a, b) => new Date(b.date) - new Date(a.date));

            sortedEntries.forEach(entry => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formatDate(entry.date)}</td>
                    <td>${entry.source}</td>
                    <td class="credit">${formatCurrency(entry.amount)}</td>
                    <td>${entry.description}</td>
                    <td>
                        <button class="action-btn delete-btn" data-id="${entry.id}">Delete</button>
                    </td>
                `;
                incomeList.appendChild(row);
            });

            // Add event listeners to delete buttons
            document.querySelectorAll('#income-list .delete-btn').forEach(button => {
                button.addEventListener('click', () => {
                    deleteIncome(button.getAttribute('data-id'));
                });
            });
        }

        // Update Total Income
        function updateTotalIncome() {
            // Calculate total income
            const totalIncome = incomeEntries.reduce((sum, entry) => sum + entry.amount, 0);

            // Update the total income display
            totalIncomeElement.textContent = formatCurrency(totalIncome);
        }

        // Dashboard Updates
        function updateDashboard() {
            // Calculate total balance across all accounts
            const totalBalance = accounts.reduce((sum, account) => sum + account.currentBalance, 0);

            // Calculate total credits and debits
            const totalCredits = transactions
                .filter(transaction => transaction.type === 'Credit')
                .reduce((sum, transaction) => sum + transaction.amount, 0);

            const totalDebits = transactions
                .filter(transaction => transaction.type === 'Debit')
                .reduce((sum, transaction) => sum + transaction.amount, 0);

            // Update the dashboard
            totalBalanceElement.textContent = formatCurrency(totalBalance);
            totalCreditsElement.textContent = formatCurrency(totalCredits);
            totalDebitsElement.textContent = formatCurrency(totalDebits);
            updateDashboardAccountSelect();
        }

        // UI Toggles
        function toggleAccountForm() {
            accountFormContainer.classList.toggle('hidden');
        }

        function toggleTransactionForm() {
            transactionFormContainer.classList.toggle('hidden');
        }

        function toggleIncomeForm() {
            incomeFormContainer.classList.toggle('hidden');
        }

        function toggleFilterSection() {
            transactionsFilter.classList.toggle('hidden');
            toggleFilterBtn.textContent = transactionsFilter.classList.contains('hidden') ? 'Show Filters' : 'Hide Filters';
        }

        // Render Transaction History Flowchart
        function renderTransactionHistory() {
            if (!transactions || transactions.length === 0) {
                document.getElementById('transaction-history-flowchart').innerHTML = '';
                noTransactionHistoryMessage.classList.remove('hidden');
                return;
            }
            noTransactionHistoryMessage.classList.add('hidden');
            const flowDiv = document.getElementById('transaction-history-flowchart');
            // Sort transactions by date (oldest first for flow)
            const sorted = [...transactions].sort((a, b) => new Date(a.date) - new Date(b.date));
            let mermaidStr = 'flowchart TD\n';
            let prevId = null;
            sorted.forEach((transaction, idx) => {
                const nodeId = 'T' + idx;
                const color = transaction.type === 'Credit' ? '#4eff8a' : '#ff4757';
                const label = `${transaction.type}\\n${transaction.accountName}\\n$${transaction.amount.toFixed(2)}\\n<span style='font-weight:bold;'>${transaction.description}</span>\\n${transaction.date}`;
                mermaidStr += `${nodeId}(["<span style='color:${color};'>${transaction.type}</span><br/><b>${transaction.description}</b><br/>${transaction.accountName}<br/>$${transaction.amount.toFixed(2)}<br/>${transaction.date}"])\n`;
                if (prevId) {
                    mermaidStr += `${prevId} --> ${nodeId}\n`;
                }
                prevId = nodeId;
            });
            // Render with Mermaid
            mermaid.initialize({ startOnLoad: false });
            mermaid.render('transactionHistoryGraph', mermaidStr, (svgCode) => {
                flowDiv.innerHTML = svgCode;
            });
        }

        // Download all transactions as PDF (DESIGNED TABLE)
        downloadPdfBtn.addEventListener('click', function () {
            if (!transactions || transactions.length === 0) {
                alert('No transactions to download.');
                return;
            }
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({ orientation: 'landscape', unit: 'pt', format: 'A4' });

            // Colors matching the webpage
            const headerBg = '#232323';
            const headerColor = '#4eff8a';
            const creditColor = '#4eff8a';
            const debitColor = '#ff4757';
            const textColor = '#e0e0e0';

            // Title
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(24);
            doc.setTextColor(headerColor);
            doc.text('Cashav - All Transactions', 40, 50);

            // Table columns
            const columns = [
                { header: 'Date', dataKey: 'date' },
                { header: 'Time', dataKey: 'time' },
                { header: 'Account', dataKey: 'accountName' },
                { header: 'Type', dataKey: 'type' },
                { header: 'Amount', dataKey: 'amount' },
                { header: 'Description', dataKey: 'description' }
            ];

            // Table rows
            const rows = transactions
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .map(tx => ({
                    date: formatDate(tx.date),
                    time: formatTime12h(tx.time),
                    accountName: tx.accountName || '',
                    type: tx.type,
                    amount: formatCurrency(tx.amount),
                    description: tx.description || ''
                }));

            // Use autoTable for styled table
            doc.autoTable({
                startY: 70,
                head: [columns.map(col => col.header)],
                body: rows.map(row => columns.map(col => row[col.dataKey])),
                theme: 'grid',
                styles: {
                    font: 'helvetica',
                    fontSize: 12,
                    textColor: textColor,
                    fillColor: '#1a1a1a',
                    cellPadding: 8,
                    halign: 'left',
                    valign: 'middle'
                },
                headStyles: {
                    fillColor: headerBg,
                    textColor: headerColor,
                    fontStyle: 'bold',
                    fontSize: 13
                },
                columnStyles: {
                    2: { // Type column
                        textColor: function (row, data) {
                            return data.row.raw[2] === 'Credit' ? creditColor : debitColor;
                        },
                        fontStyle: 'bold'
                    },
                    3: { // Amount column
                        fontStyle: 'bold'
                    }
                },
                didDrawCell: function (data) {
                    // Highlight Credit/Debit colors
                    if (data.column.index === 2 && data.cell.text[0] === 'Credit') {
                        data.cell.styles.textColor = creditColor;
                    }
                    if (data.column.index === 2 && data.cell.text[0] === 'Debit') {
                        data.cell.styles.textColor = debitColor;
                    }
                },
                margin: { left: 40, right: 40 }
            });

            // Footer
            doc.setFontSize(10);
            doc.setTextColor('#888');
            doc.text('Generated by Cashav | Personal Finance Manager', 40, doc.internal.pageSize.height - 30);

            doc.save('cashav_transactions.pdf');
        });

        // Dashboard Account Balance Checker
        function updateDashboardAccountSelect() {
            if (!dashboardAccountSelect) return;
            dashboardAccountSelect.innerHTML = '<option value="">Select Account</option>';
            accounts.forEach(account => {
                const option = document.createElement('option');
                option.value = account.id;
                option.textContent = `${account.bankName} - ${account.accountNumber}`;
                dashboardAccountSelect.appendChild(option);
            });
            dashboardAccountBalanceCard.style.display = 'none'; // Hide card on update
        }

        dashboardAccountOkBtn && dashboardAccountOkBtn.addEventListener('click', function () {
            const selectedId = dashboardAccountSelect.value;
            if (!selectedId) {
                dashboardAccountBalanceCard.style.display = 'none';
                return;
            }
            const account = accounts.find(acc => acc.id === selectedId);
            if (account) {
                dashboardAccountName.textContent = `${account.bankName} - ${account.accountNumber}`;
                dashboardAccountBalance.textContent = formatCurrency(account.currentBalance);
                dashboardAccountBalanceCard.style.display = '';
            } else {
                dashboardAccountBalanceCard.style.display = 'none';
            }
        });

        // --- Auto-Save Monthly PDF Feature ---
        const autoSaveMonthlyPdfToggle = document.getElementById('autoSaveMonthlyPdfToggle');
        // Save toggle state in localStorage
        function setAutoSaveMonthlyPdfState(state) {
            localStorage.setItem('autoSaveMonthlyPdf', state ? 'on' : 'off');
        }
        function getAutoSaveMonthlyPdfState() {
            return localStorage.getItem('autoSaveMonthlyPdf') === 'on';
        }
        // Initialize toggle state
        if (autoSaveMonthlyPdfToggle) {
            autoSaveMonthlyPdfToggle.checked = getAutoSaveMonthlyPdfState();
            autoSaveMonthlyPdfToggle.addEventListener('change', function () {
                setAutoSaveMonthlyPdfState(this.checked);
            });
        }

        // Helper: is today last day of month?
        function isLastDayOfMonth(date) {
            const d = new Date(date.getFullYear(), date.getMonth() + 1, 0);
            return date.getDate() === d.getDate();
        }

        // Helper: get all transactions for current month
        function getCurrentMonthTransactions() {
            const now = new Date();
            const year = now.getFullYear();
            const month = now.getMonth();
            return transactions.filter(tx => {
                const d = new Date(tx.date);
                return d.getFullYear() === year && d.getMonth() === month;
            });
        }

        // Generate and download PDF for current month
        function downloadCurrentMonthPdf() {
            const monthTxs = getCurrentMonthTransactions();
            if (!monthTxs.length) return;
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({ orientation: 'landscape', unit: 'pt', format: 'A4' });
            const headerBg = '#232323';
            const headerColor = '#4eff8a';
            const creditColor = '#4eff8a';
            const debitColor = '#ff4757';
            const textColor = '#e0e0e0';
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(24);
            doc.setTextColor(headerColor);
            const now = new Date();
            const monthName = now.toLocaleString('default', { month: 'long', year: 'numeric' });
            doc.text(`Cashav - Transactions for ${monthName}`, 40, 50);
            const columns = [
                { header: 'Date', dataKey: 'date' },
                { header: 'Time', dataKey: 'time' },
                { header: 'Account', dataKey: 'accountName' },
                { header: 'Type', dataKey: 'type' },
                { header: 'Amount', dataKey: 'amount' },
                { header: 'Description', dataKey: 'description' }
            ];
            const rows = monthTxs
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .map(tx => ({
                    date: formatDate(tx.date),
                    time: formatTime12h(tx.time),
                    accountName: tx.accountName || '',
                    type: tx.type,
                    amount: formatCurrency(tx.amount),
                    description: tx.description || ''
                }));
            doc.autoTable({
                startY: 70,
                head: [columns.map(col => col.header)],
                body: rows.map(row => columns.map(col => row[col.dataKey])),
                theme: 'grid',
                styles: {
                    font: 'helvetica',
                    fontSize: 12,
                    textColor: textColor,
                    fillColor: '#1a1a1a',
                    cellPadding: 8,
                    halign: 'left',
                    valign: 'middle'
                },
                headStyles: {
                    fillColor: headerBg,
                    textColor: headerColor,
                    fontStyle: 'bold',
                    fontSize: 13
                },
                columnStyles: {
                    3: { // Type column
                        textColor: function (row, data) {
                            return data.row.raw[3] === 'Credit' ? creditColor : debitColor;
                        },
                        fontStyle: 'bold'
                    },
                    4: { // Amount column
                        fontStyle: 'bold'
                    }
                },
                didDrawCell: function (data) {
                    if (data.column.index === 3 && data.cell.text[0] === 'Credit') {
                        data.cell.styles.textColor = creditColor;
                    }
                    if (data.column.index === 3 && data.cell.text[0] === 'Debit') {
                        data.cell.styles.textColor = debitColor;
                    }
                },
                margin: { left: 40, right: 40 }
            });
            doc.setFontSize(10);
            doc.setTextColor('#888');
            doc.text('Generated by Cashav | Personal Finance Manager', 40, doc.internal.pageSize.height - 30);
            doc.save(`cashav_transactions_${monthName.replace(/ /g, '_')}.pdf`);
        }

        // Check and auto-save on last day of month
        function checkAutoSaveMonthlyPdf() {
            if (!getAutoSaveMonthlyPdfState()) return;
            const today = new Date();
            if (isLastDayOfMonth(today)) {
                // Only save once per day
                const lastSaved = localStorage.getItem('autoSaveMonthlyPdfLastSaved');
                const todayStr = today.toISOString().slice(0, 10);
                if (lastSaved === todayStr) return;
                downloadCurrentMonthPdf();
                localStorage.setItem('autoSaveMonthlyPdfLastSaved', todayStr);
            }
        }

        // Run check on load
        checkAutoSaveMonthlyPdf();
        // Set interval to check every hour (in case app is open at midnight)
        setInterval(checkAutoSaveMonthlyPdf, 60 * 60 * 1000);

        // Event Listeners
        // Navigation
        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const section = link.getAttribute('data-section');
                showSection(section);
            });
        });

        // Accounts
        addAccountBtn.addEventListener('click', toggleAccountForm);
        cancelAccountBtn.addEventListener('click', toggleAccountForm);
        accountForm.addEventListener('submit', addAccount);

        // Transactions
        addTransactionBtn.addEventListener('click', () => {
            if (accounts.length === 0) {
                alert('Please add at least one account before adding transactions.');
                return;
            }
            toggleTransactionForm();
            setCurrentDate();
        });
        cancelTransactionBtn.addEventListener('click', toggleTransactionForm);
        transactionForm.addEventListener('submit', addTransaction);

        // Filters
        applyFilterBtn.addEventListener('click', filterTransactions);
        resetFilterBtn.addEventListener('click', resetFilters);
        toggleFilterBtn.addEventListener('click', toggleFilterSection);

        // Income
        addIncomeBtn.addEventListener('click', toggleIncomeForm);
        cancelIncomeBtn.addEventListener('click', toggleIncomeForm);
        incomeForm.addEventListener('submit', addIncome);

        // On app init
        document.addEventListener('DOMContentLoaded', () => {
            initApp();
        });

        // Toggle show/hide for autosave toggle
        const autosaveToggleBtn = document.getElementById('autosave-toggle-btn');
        const autosaveToggleContainer = document.getElementById('autosave-toggle-container');
        let autosaveToggleVisible = false;
        function showAutosaveToggle() {
            autosaveToggleContainer.style.display = 'flex';
            setTimeout(() => autosaveToggleContainer.classList.add('visible'), 10);
            autosaveToggleVisible = true;
        }
        function hideAutosaveToggle() {
            autosaveToggleContainer.classList.remove('visible');
            setTimeout(() => autosaveToggleContainer.style.display = 'none', 250);
            autosaveToggleVisible = false;
        }
        autosaveToggleBtn.addEventListener('click', function (e) {
            e.stopPropagation();
            if (autosaveToggleVisible) {
                hideAutosaveToggle();
            } else {
                showAutosaveToggle();
            }
        });
        // Hide on click outside
        document.addEventListener('click', function (e) {
            if (autosaveToggleVisible && !autosaveToggleContainer.contains(e.target) && e.target !== autosaveToggleBtn) {
                hideAutosaveToggle();
            }
        });
    </script>
</body>

</html>